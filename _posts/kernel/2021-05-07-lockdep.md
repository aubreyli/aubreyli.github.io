---
layout: post
#comments: true
categories: kernel
---

## Lockdep - Runtime locking correctness validator
Sparse诞生于2004年，是由Linux之父开发的，目的就是提供一个静态检查代码的工具，从而减少Linux内核的隐患。
起始，在Sparse之前已经有了一个不错的代码静态检查工具（SWAT），只不过这个工具不是免费软件，使用上有一些限制。
所以Linus自己开发了一个静态检查工具。

内核代码中有一个对Sparse的简略说明文档：Documentation/sparse.txt。

Sparse通过gcc的扩展属性__attribute__以及自己定义的__context__来对代码进行静态检查。

这些属性如下：

	宏名称		宏定义					说明
	__acquires(x)	__attribute__((context(x, 0, 1)))	参数x 在执行前引用计数必须是0,执行后,引用计数必须为1
	__releases(x)	__attribute__((context(x, 1, 0)))	与__acquires(x)相反
	__acquire	__context__(x, 1)			参数x的引用计数+1
	__release	__context__(x, 1)			与__acquire(x)相反

其中__acquires(x)和__releases，__acquire和__release必须配对使用，否则Sparse会发出警告
